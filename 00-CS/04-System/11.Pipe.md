# Pipe

## Similar Concepts
- Redirection
    - Changing the direction of a stream
    - Ex. Changing STDIN to a file (not STDOUT)
    - Shell commands for Stream redirection
        - `A > file` : redirect output stream
            - `ls -al > ls.txt`
        - `A < file` : redirect input stream
            - `wc -m < ls.txt`

## Background (Pipe)
- One method of IPC
- Tunnel that connects in/ouputs between two processes
- Named pipe / Anonymous pipe
- Mechanism:
    - One-way communication
    - FIFO
        - Read content is not left in pipe
        - C B A (FD for writing) -> pip file -> C B A (FD for reading)

## Shell Commands
- `A | B`
    - Connect Process A's STDOUT with process B's STDIN
    - `ls -al | grep bashrc`
    - `ls | sort`

## Anonymous Pipe
- Usually, pipe stands for anonymous pipe
- Used for parent-child process communication
- Related functions
    - `pipe(2)`
        - `int pipe(int pipefd[2]);`
        - Opens pipe stream, and creates/returns FD for read/write
        - pipefd[0] : fd for read
        - pipefd[1] : fd for write
        - pipe[1] (write) -> pipe stream -> pipe[0] (read)
        - P-C communication with a pipe
            - 1. Create pipe stream
            - 2. fork() so that both processes have fd[0], fd[1]
            - 3. Decide communication direction (which one is to read, which one is to write?)
        - For bidirectional communication, create two pipe streams
    - `popen(3)`
        - `FILE *popen(const char *command, const char *type);`
        - Opening a pipe stream
        - command: command to execute
        - type: pipe access mode
            - r, w
            - r: on popen(), child is forked, and command is executed
            - w: on popen(), executed result is put into pipe
        - returns: file pointer for the stream
    - `pclose(3)`
        - `int pclose(FILE *stream);`
        - Closing a pipe stream

## Named Pipe
- Special file
    - FIFO file (man -s 7 FIFO)
- Used for communication between independent processes
    - FIFO file must be created beforehand
    - Delivers data internally within kernel
        - Content is not written in file