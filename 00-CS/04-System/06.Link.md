# Link

## Hard Link
- Directory (file) --> Hard link --> I-list (i-node) --> Disk (Data block)
- Name-to-inode mapping in a directory
- Can create multiple hard links in same file system
    - link number = hard link number
    - link number = 0 --> file delete (free data block)
- Impossible to hard link inode in another file system

## Soft Link (Symbolic Link)
- Directory (file) --> Hard link --> I-list (i-node) --> Disk (Path to file)
- file that saves real file's path (new inode)
- possible to link another file system's file/folder

## Basic commands for link (Shell)
- `ln` : Creates link
    - `-d` : creates link for directory (needs root permission)
    - `-s` : creates soft link (symbolic link)
- Creating a hard link
```sh
➜  04-System git:(main) echo "This is the file A" > link1.txt
➜  04-System git:(main) ✗ cat link1.txt
This is the file A
➜  04-System git:(main) ✗ ls -il *.txt
50387037 -rw-r--r--  1 haeunkang  staff  19 Aug  5 23:40 link1.txt
50378841 -rw-r--r--  1 haeunkang  staff   0 Aug  5 23:28 linux.txt
➜  04-System git:(main) ✗ ln link1.txt link2.txt
➜  04-System git:(main) ✗ cat link2.txt
This is the file A
➜  04-System git:(main) ✗ ls -il *.txt          
50387037 -rw-r--r--  2 haeunkang  staff  19 Aug  5 23:40 link1.txt
50387037 -rw-r--r--  2 haeunkang  staff  19 Aug  5 23:40 link2.txt
50378841 -rw-r--r--  1 haeunkang  staff   0 Aug  5 23:28 linux.txt
➜  04-System git:(main) ✗ 
```
- Creating a soft link
```sh
➜  04-System git:(main) ✗ ln -s link1.txt link3.txt
➜  04-System git:(main) ✗ ls -il *.txt             
50387037 -rw-r--r--  2 haeunkang  staff  19 Aug  5 23:40 link1.txt
50387037 -rw-r--r--  2 haeunkang  staff  19 Aug  5 23:40 link2.txt
50387095 lrwxr-xr-x  1 haeunkang  staff   9 Aug  5 23:41 link3.txt -> link1.txt
50378841 -rw-r--r--  1 haeunkang  staff   0 Aug  5 23:28 linux.txt
```

## Basic commands for link (System call)
- Create hard link
    - `int link (const char *oldpath, const char *newpath);`
- Create soft link
    - `int symlink (const char *target, const char *linkpath);`
```c
#include <sys/types.h>
#include <sys/stat.h>
#include <unistd.h>
#include <stdio.h>

int main(void) {
    struct stat buf;

    stat("linux.txt", &buf);
    printf("Before Link Count = %d\n", (int)buf.st_nlink);

    link("linux.txt", "linux.ln");      // create a hard link

    symlink("linux.txt", "linux.sym");  // create a soft link

    stat("linux.txt", &buf);
    printf("After Link Count = %d\n", (int)buf.st_nlink);

    return 0;
}
```
- Remove hard link
    - `int unlink (const char *pathname);`
        - Cannot use for directory
    - `int remove (const char *pathname);`
        - Can use for directory
- Get symbolic link file Info
    - `int lstat (const char * pathname, struct stat *buf);`
        - Retrieves information of symbolic link
    - `ssize_t readlink (const char *pathname, char *buf, size_t bufsiz);`
        - Reads data saved in symbolic link
    - `char* realpath (const char *path, chat *resolved_path);`
        - Reads absolute path that symbolic link is pointing to