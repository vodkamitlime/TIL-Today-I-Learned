# 브라우저에서 모든 script 를 한 번에 실행하면 안되는 이유

## js 파일이 브라우저에서 실행되는 작동 원리
- 브라우저는 html 파일을 위에서 아래로 읽어 나가며 파싱을 한며, 이 때 dom 이 생성된다.
- 브라우저는 script 태그를 만나면 파싱을 잠시 중단하고 그에 해당하는 javascript 파일을 다운받는다.

### 기본 문제점
- 중요한 특징은, 스크립트는 대부분 html 보다 무겁다는 점이다. js 파일은 용량이 커서 다운받는 시간이 길다. 
- 페이지 위쪽에 용량이 큰 스크립트가 있는 경우 스크립트가 페이지를 ‘막아버린다’. 
- 페이지에 접속하는 사용자들은 스크립트를 다운받고 실행할 때까지 스크립트 아래쪽 페이지를 볼 수 없게 된다.

### 심화 문제점 
- 만약 여러 개의 자바스크립트 파일이 head 에 위치한다면 어떻게 될까?
- head 는 최상단에 메타태그나 html 전반을 정의하는 내용이 담긴 태그이며, 그리고 html 파싱은 앞서 말한대로 위에서 아래로 진행된다.
- js 파일이 head 태그 내 위치한다면 body 의 dom 파싱이 완료되지 않은 상태에서 js 스크립트가 먼저 실행되어 에러가 발생하거나, 유저에게 빈 화면을 보여주게 된다. 
- 성능 측면에서 굉장히 불리하며, 서비스 측면에서 유저 이탈 유발 가능성이 높다.
- 최악의 경우, html 이 제대로 로딩조차 되지 않을수도 있다.

## 해결책
### 기본
- script 코드를 body 끝에 넣으면 기본적인 문제를 해결한다.
- 하지만 이 역시 파일 용량이 크면 브라우저 속도를 저하시키는 것은 마찬가지이다.

### 심화
- script 의 defer 와 async 속성을 활용한다.
- defer
```html
<script defer src="...">
 ```
    - 브라우저는 defer 스크립트를 백그라운드에서 다운로드 한다. 파일을 다운로드 하는 도중에도 HTML 파싱은 멈추지 않고, 스크립트 실행은 페이지 구성이 끝날 때까지 지연된다.
    - 하지만 defer 태그는 외부 script (src) 에만 적용 가능하다는 단점이 있다.
- async
```html
<script async src="...">
```
    - defer 와 마찬가지로 스크립트를 백그라운드에서 다운로드하며, 다운로드 도중 html 파싱을 멈추지 않는다.
- defer 와 async 의 차이점
    - script가 여러개 있을 경우의 실행 순서
        - defer script 는 html 위치순으로 실행된다.
        - async script 는 먼저 다운로드 된 (용량이 작은) script를 먼저 실행하며, 실행 순서는 예측이 어렵다. 
    - DOMContentLoaded
        - defer script 는 html 완전히 다운, 파싱된 후 (화면이 출력된 뒤) 실행된다 (Domcontentloaded 이전)
        - async script 는 html 완전히 다운되지 않아도 로드, 실행이 가능하다 (Domcontentloaded 이전이나 이후)